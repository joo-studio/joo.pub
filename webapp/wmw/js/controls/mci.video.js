/**
* h5player v0.0.1 by yangyin 
* Copyright 2014 yangyin@mcitech.cn http://weibo.com/nodersolar
*/
!function(a){"function"==typeof define&&define.amd?define("mci.video",["jquery"],a):a(jQuery)}(function(a){"use strict";var b=function(a){return this instanceof b?this.init(a):new b(a)};return b.prototype.init=function(b){var c=this;if(c.options=c.options||{autoPlay:!1,autoStop:!1,autoPlayDelay:0,videoRes:"",coverRes:"",fullscreen:!1,controlBar:!1,loopTime:0},c.options=a.extend(c.options,b),!c.options.dom)throw"setting dom can't be null or undefine";c.dom=c.options.dom,c.video=c.dom.find(">.mci-video-i >video"),c.videoContainer=c.dom.find(">.mci-video-i.video"),c.cover=c.dom.find(">.mci-video-i.cover"),c.loopedCount=0},b.prototype.handleEvent=function(a){switch(a.type){case"click":}},b.prototype._createFullScreenVideo=function(){var b=this,c=window.pageWidth||a("body").height(),d=window.pageHeight||a("body").width(),e=a('<div id="mci-f-v-wrap" class="mci-video-fullsreen"><span class="close"></span></div>');b.video.appendTo(e),e.find(".close").on("click",function(a){a.preventDefault(),a.stopPropagation(),b.stop()}),b.video.css({height:d+"px",width:c+"px"}),a("body").append(e)},b.prototype._exitFullScreenVideo=function(){var b=this;b.video.appendTo(b.videoContainer),a("#mci-f-v-wrap").remove(),b.video.css({height:b.options.height+"px",width:b.options.width+"px"})},b.prototype._bindEvent=function(){var a=this;a.video.on("error",function(){a.options.fullscreen&&a._exitFullScreenVideo(),a.cover.removeClass("hidden"),a.video.hide()}),a.video.on("ended",function(){-1==a.options.loopTime&&0==a.stoped?(a.video[0].currentTime=0,a.loadVideo(a.options.videoRes),a.video[0].play()):0==a.stoped&&a.loopedCount<a.options.loopTime?(a.loopedCount=a.loopedCount+1,a.video[0].currentTime=0,a.loadVideo(a.options.videoRes),a.video[0].play()):a.stop()})},b.prototype.start=function(){var a=this;a.stoped=!1,a.options.controlBar&&a.video.attr("controls","controls"),a.cover.removeClass("hidden"),a.options.width&&a.video.attr("width",a.options.width+"px"),a.options.height&&a.video.attr("height",a.options.height+"px"),a._bindEvent(),a.loadVideo(a.options.videoRes),a.options.autoPlay?(a.options.fullscreen&&a._createFullScreenVideo(),a.options.autoPlayDelay>0?setTimeout(function(){a.cover.addClass("hidden"),a.video[0].play(),a.loopedCount=a.loopedCount+1},a.options.autoPlayDelay):(a.loopedCount=a.loopedCount+1,a.cover.addClass("hidden"),a.video[0].play())):a.cover.on("click",function(b){b.preventDefault(),b.stopPropagation(),a.loopedCount=1,a.cover.addClass("hidden"),a.options.fullscreen&&a._createFullScreenVideo(),a.loadVideo(a.options.videoRes),a.video[0].play()})},b.prototype.loadVideo=function(a){var b=this;b.video.html(""),b.video.append('<source src="'+a.replace(".mp4",".ogv")+'" type=\'video/ogg; codecs="theora, vorbis"\'/>'),b.video.append('<source src="'+a.replace(".mp4",".webm")+"\" type='video/webm' >"),b.video.append('<source src="'+a+"\" type='video/mp4' >")},b.prototype.stop=function(){var a=this;a.stoped=!0,a.options.fullscreen&&a._exitFullScreenVideo(),a.cover.removeClass("hidden"),a.video[0].pause(),a.loopedCount=0},window.MciVideo=b,MciVideo});