/**
* h5player v0.0.1 by yangyin 
* Copyright 2014 yangyin@mcitech.cn http://weibo.com/nodersolar
*/
!function(a){"function"==typeof define&&define.amd?define("mci.overlaypage",["jquery","mci.support"],a):a(jQuery,Support)}(function(a,b){function c(a){return this instanceof c?this.init(a):new c(a)}var d=window.overlaySections,e=window.CommonSections;return c.prototype.init=function(b){var c=this;return c.options=c.options||{dom:null,count:0,width:768,height:1024},c.options=a.extend(c.options,b),c.dom=c.options.dom,c.dom?(c.itemIndex=0,c.sectionIndex=0,c.currentX=0,c.currentY=0,c.itemsCount=c.dom.find(".cpage").length,c):null},c.prototype._getPageHeight=function(){var b=this;return window.pageWidth=a(window).width(),window.pageHeight=a(window).height(),b.options.height=window.pageHeight,b.options.width=window.pageWidth,window.pageHeight},c.prototype._getPageWidth=function(){var b=this;return window.pageWidth=a(window).width(),window.pageHeight=a(window).height(),b.options.height=window.pageHeight,b.options.width=window.pageWidth,window.pageWidth},c.prototype._getCurrentY=function(){var a=this;return a._getPageHeight(),a.currentY},c.prototype._getCurrentX=function(){var a=this;return a._getPageHeight(),a.currentX},c.prototype._syncMove=function(a){var b=this;if(b.moving=!1,1==a.slideDirection){if(d[a.pageIndex][a.from]!=d[a.pageIndex][a.to]){b._getCurrentY();var c=a.dist+b.currentY;b.moving=!0,b._setSectionTransition(!1),b._setY(c,a)}}else if(d[a.pageIndex][a.sectionIndex]!=d[a.to][0]){b._getCurrentX();var e=a.dist+b.currentX;b.moving=!0,b._setTransition(!1),b._setX(e,a)}},c.prototype._syncMoveEnd=function(b){var c=this;if(1==b.slideDirection){if(c._getCurrentY(),b.to>d[b.pageIndex].length-1&&(b.to=d[b.pageIndex].length-1),-1==b.to&&(b.to=0),c.moving||d[b.pageIndex][b.from]!=d[b.pageIndex][b.to]){c.moving=!1;var e=-(c.sectionIndex+b.incre)*c.options.height;c._setSectionTransition(!0),b.direction=0,e-c.currentY>0?b.direction=-1:e-c.currentY<0&&(b.direction=1),c._setY(e,b),c.sectionIndex=c.sectionIndex+b.incre,0!=b.incre&&a.isFunction(c.options.sectionChanged)&&setTimeout(function(){var a={};a.type=1,a.sender=c,c.options.sectionChanged(a)},255)}}else if(c._getCurrentX(),b.to>d.length-1&&(b.to=d.length-1),-1==b.to&&(b.to=0),c.moving||d[b.from][b.sectionIndex]!=d[b.to][0]){c.moving=!1,0!=b.incre&&(c.sectionIndex=0,c.currentY=0);var f=-(c.itemIndex+b.incre)*c.options.width;c._setTransition(!0),b.direction=0,f-c.currentX>0?b.direction=-1:f-c.currentX<0&&(b.direction=1),c._setX(f,b),c.itemIndex=c.itemIndex+b.incre,0!=b.incre&&a.isFunction(c.options.sectionChanged)&&setTimeout(function(){var a={};a.type=-1,a.sender=c,c.options.sectionChanged(a)},255)}},c.prototype._setX=function(b,c){var f=this;f.currentX=b;var g=f.dom.find(".cpage");if(c.direction<0){if(f.currentX>0&&0==f.itemIndex){var h=g.eq(1);h.remove().css({transition:"",transform:f._getTranslate(0,0,0)}),f.toPage=null,f.toSection=null,h.find(".cpage-i").html("");var i=h.find(".cpage-i:first-child");if(-1!=c.to&&i.html(e["_"+d[c.to][0]]),f.dom.prepend(h),a.isFunction(f.options.sectionChanging)){var j={};j.sender=f,j.dom=i,j.type=-1,f.options.sectionChanging(j)}f.currentX=f.currentX-f.options.width,f.itemIndex=f.itemIndex+1}else if(g.eq(0).css({transition:"",transform:f._getTranslate(0,0,0)}),!f.toPage&&(g.eq(0).find(".cpage-i:first-child").html(""),g.eq(0).find(".cpage-i:first-child").html(e["_"+d[c.to][0]]),f.toSection=null,a.isFunction(f.options.sectionChanging))){var j={};j.sender=f,j.dom=g.eq(0).find(".cpage-i:first-child"),j.type=-1,f.options.sectionChanging(j)}}else if(c.direction>0)if(f.currentX<-f.options.width&&1==f.itemIndex){var k=g.eq(0);if(k.remove().css({transition:"",transform:f._getTranslate(0,0,0)}),k.find(".cpage-i").html(""),-1!=c.to&&k.find(".cpage-i:first-child").html(e["_"+d[c.to][0]]),f.toPage=null,f.toSection=null,f.dom.append(k),a.isFunction(f.options.sectionChanging)){var j={};j.sender=f,j.dom=k.find(".cpage-i:first-child"),j.type=-1,f.options.sectionChanging(j)}f.itemIndex=f.itemIndex-1,f.currentX=f.currentX+f.options.width}else if(g.eq(1).css({transition:"",transform:f._getTranslate(0,0,0)}),!f.toPage&&(g.eq(1).find(".cpage-i:first-child").html(""),g.eq(1).find(".cpage-i:first-child").html(e["_"+d[c.to][0]]),a.isFunction(f.options.sectionChanging))){var j={};j.sender=f,j.dom=g.eq(1).find(".cpage-i:first-child"),j.type=-1,f.options.sectionChanging(j)}f.dom.attr("data-offset",f.currentX),f._setContainerStyle({transform:f._getTranslate(f.currentX,0,0)})},c.prototype._setY=function(b,c){var f=this;f.currentY=b;var g=f.dom.find(".cpage").eq(f.itemIndex),h=g.find(".cpage-i");if(c.direction<0){if(f.currentY>0&&0==f.sectionIndex){var i=h.eq(1);if(i.remove().html(""),f.toSection=null,-1!=c.to&&i.html(e["_"+d[c.pageIndex][c.to]]),g.prepend(i),a.isFunction(f.options.sectionChanging)){var j={};j.sender=f,j.dom=i,j.type=1,f.options.sectionChanging(j)}f.currentY=f.currentY-f.options.height,f.sectionIndex=f.sectionIndex+1}else if(!f.toSection&&(h.eq(0).html(""),h.eq(0).html(e["_"+d[c.pageIndex][c.to]]),a.isFunction(f.options.sectionChanging))){var j={};j.sender=f,j.dom=h.eq(0),j.type=1,f.options.sectionChanging(j)}}else if(c.direction>0)if(f.currentY<-f.options.height&&1==f.sectionIndex){var k=h.eq(0);if(k.remove().html(""),f.toSection=null,-1!=c.to&&k.html(e["_"+d[c.pageIndex][c.to]]),g.append(k),a.isFunction(f.options.sectionChanging)){var j={};j.sender=f,j.dom=k,j.type=1,f.options.sectionChanging(j)}f.currentY=f.currentY+f.options.height,f.sectionIndex=f.sectionIndex-1}else if(!f.toSection&&(h.eq(1).html(""),h.eq(1).html(e["_"+d[c.pageIndex][c.to]]),a.isFunction(f.options.sectionChanging))){var j={};j.sender=f,j.dom=h.eq(1),j.type=1,f.options.sectionChanging(j)}f.dom.find(".cpage").eq(f.itemIndex).attr("data-offset",f.currentY),f._setSectionContainerStyle({transform:f._getTranslate(0,f.currentY,0)})},c.prototype._setSectionContainerStyle=function(a){var b=this;if(a){var c=b.dom.find(".cpage").eq(b.itemIndex);c.css(a)}},c.prototype._getTranslate=function(a,c,d){var a=a||"0",c=c||"0",d=d||"0";return-1==c.toString().indexOf("%")&&(c+="px"),-1==a.toString().indexOf("%")&&(a+="px"),b.transform3d?"translate3d("+a+", "+c+", "+d+"px)":"translate("+a+", "+c+")"},c.prototype._setContainerStyle=function(a){var b=this;a&&b.dom.css(a)},c.prototype._setSectionTransition=function(a){var c=this;c._setSectionContainerStyle(a?{transition:b.getCSSVal("transform")+" 250ms ease"}:{transition:""})},c.prototype._setTransition=function(a){var c=this;c._setContainerStyle(a?{transition:b.getCSSVal("transform")+" 250ms ease"}:{transition:""})},c.prototype.start=function(a){var b=this,c=b.dom.find(".cpage").eq(b.itemIndex),d=c.find(".cpage-i");return d.eq(b.sectionIndex).html(a),d.eq(b.sectionIndex)},c.prototype.getSectionContainer=function(){{var a=this,b=a.dom.find(".cpage").eq(a.itemIndex);b.find(".cpage-i")}},c.prototype._resizeView=function(){var b=this;b._setSectionTransition(!1),b._setTransition(!1),window.pageWidth=a(window).width(),window.pageHeight=a(window).height();var c=b.options.height,d=b.options.width;b.direction=0,b.options.height=window.pageHeight,b.options.width=window.pageWidth;var e=b.dom.attr("data-offset");e&&0/0!=e||(e=0),b._setX(b.options.width*e/d,{direction:0});for(var f=b.dom.find(".cpage"),g=0;g<f.length;g++)if(g==b.itemIndex){var h=f.eq(b.itemIndex).attr("data-offset");h&&0/0!=h||(h=0),b._setY(b.options.height*h/c,{direction:0})}else f.eq(g).css({transform:b._getTranslate(0,0,0)})},window.Overlaypage=c,c});