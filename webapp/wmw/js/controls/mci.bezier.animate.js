/**
* h5player v0.0.1 by yangyin 
* Copyright 2014 yangyin@mcitech.cn http://weibo.com/nodersolar
*/
!function(a){"function"==typeof define&&define.amd?define("mci.bezier.animate",["jquery"],a):a(jQuery)}(function(a){function b(b){var c=this,d=this;this.options=b,this.autoPlay=b.autoPlay,this.delay=b.delay,this.loop=b.loop,this.loopCount=b.loopCount,this.endToHead=b.endToHead,this.reverse=!1,this.$this=b.$this,this.$this[0].holder=this,this.orginCss={},this.data=b.data,this.animateFinished=b.animateFinished||function(){},this.orginCss.opacity=1,this.orginCss.left=this.data[0].start.x+"px",this.orginCss.top=this.data[0].start.y+"px",this.orginCss.zoomRateX=this.data[0].reverseCss.zoomRateX,this.orginCss.zoomRateY=this.data[0].reverseCss.zoomRateY,this.orginCss.rotate=this.data[0].reverseCss.rotate,this.duration=b.duration,this.aniObj=null,this.infinte=!1,this.started=!1,0==this.loopCount&&(this.loopCount=1),-1==this.loopCount&&(this.infinte=!0),this.loop||(this.loopCount=1,this.infinte=!1),this.endToHead&&(this.loopCount*=2),this.autoPlay||(this.delay=0),this._finished=function(){a.isFunction(this.animateFinished)&&this.animateFinished(b)},this.running=function(b){var c={};c.relativePosition=b,c.syncTo=d.options.syncTo,c.syncFrom=d.options.syncFrom,c.type=0,c.direction=0,(""!=c.syncTo||""!=c.syncFrom)&&a.isFunction(d.options.syncMoving)&&d.options.syncMoving(c)},this._syncMove=function(c){var e=new a.path.bezier(b);b.$this.stop();var f=e.pointToPostion(c.relativePosition),g=e.getTransform(c.relativePosition);b.$this.css({top:f.top,left:f.left,transform:"translateZ(0) scale("+g.zoomX+","+g.zoomY+") rotate("+g.rotate+"deg)"}),d.lastPosition=c.relativePosition;var h={};a.extend(h,c),h.syncTo="",h.syncFrom="",-1!=c.direction&&(h.syncTo=d.options.syncTo,d.options.syncMoving(h)),1!=c.direction&&(h.syncFrom=d.options.syncFrom,d.options.syncMoving(h))},this._syncEnd=function(e){b.$this.stop().animate({momentumScroll:{target:d,time:e.time,pos:e.relativePosition,startPos:d.lastPosition}},{queue:!0,easing:"linear",duration:e.time});var f={};a.extend(f,e),f.syncTo="",f.syncFrom="",-1!=e.direction&&(f.syncTo=c.options.syncTo,d.options.syncMoveEnd(f)),1!=e.direction&&(f.syncFrom=c.options.syncFrom,d.options.syncMoveEnd(f))},this.start=function(b){if(1!=this.started&&(this.show(),this.run(b),this.childControl)){var c=this.childControl;for(var d in c)a.isFunction(c[d].start)&&(c[d].isRunning||(c[d].start(),c[d].isRunning=!0))}},this.run=function(a){1==this.autoPlay||1==a?(this.$this.css({"pointer-events":"none"}),this.started=!0,this.aniFun(1)):this.$this.click(function(){this.holder.started=!0,this.holder.aniFun(1)})},this.loopBezier=function(b){this.reverse=!this.reverse,this.aniObj=this.aniObj.animate({path:new a.path.bezier({reverse:this.endToHead&&this.reverse,data:this.data,aniObject:d})},{queue:!0,duration:this.duration,easing:"linear",complete:function(){return b++,!this.holder.infinte&&b>this.holder.loopCount?void c._finished():void(this.holder.endToHead?this.holder.loopBezier(b):(this.holder.reset(),this.holder.loopBezier(b)))}})},this.aniFun=function(b){this.reverse=!1,this.aniObj=this.stop().delay(this.delay).animate({path:new a.path.bezier({reverse:this.reverse,data:this.data,aniObject:d})},{queue:!0,easing:"linear",duration:this.duration,complete:function(){return b++,!this.holder.infinte&&b>this.holder.loopCount?void c._finished():void(this.holder.endToHead?this.holder.loopBezier(b):(this.holder.reset(),this.holder.loopBezier(b)))}})},this.stop=function(){return null!==this.aniObj?this.aniObj.stop().css(this.orginCss).css({transform:"translateZ(0) scale("+this.orginCss.zoomRateX+","+this.orginCss.zoomRateY+") rotate("+this.orginCss.rotate+"deg)"}):this.$this},this.reset=function(){if(1==this.started&&(this.aniObj&&this.aniObj.stop().css(this.orginCss).css({transform:"translateZ(0) scale("+this.orginCss.zoomRateX+","+this.orginCss.zoomRateY+") rotate("+this.orginCss.rotate+"deg)"}),this.isRunning=!1,this.started=!1,this.childControl)){var b=this.childControl;for(var c in b)a.isFunction(b[c].reset)&&b[c].reset()}},this.hide=function(){},this.show=function(){},this._setCss=function(a){var b=this;b.$this.css(a).css({transform:"translateZ(0) scale("+this.orginCss.zoomRateX+","+this.orginCss.zoomRateY+") rotate("+this.orginCss.rotate+"deg)"})}}return a.path={},a.path.bezier=function(a){this.curentSeg=0,this.preSeg=-1,this.minI=0,this.reverse=a.reverse,this.aniObject=a.aniObject,this.getPoint=function(b){this.reverse&&(b=1-b,this.minI=0);for(var c=a.data.length-1;c>=this.minI;c--){var d=a.data[c];if(b>=d.startTime){b-=d.startTime,b/=d.timeRatio,this.startNext=!1,this.preSeg!=c&&(this.setV(d),this.curentSeg=c,this.minI=c,this.startNext=!0),this.preSeg=c;break}}b=b>1?1:b;var e={},f={},g={},h={},i={},j=1-b,k=3*b,l=3*Math.pow(b,2),m=Math.pow(b,3),n=Math.pow(j,3),o=Math.pow(j,2);return e.x=n*this.start.x,e.y=n*this.start.y,f.x=o*this.startControl.x*k,f.y=o*this.startControl.y*k,g.x=l*j*this.endControl.x,g.y=l*j*this.endControl.y,h.x=m*this.end.x,h.y=m*this.end.y,i.x=e.x+f.x+g.x+h.x,i.y=e.y+f.y+g.y+h.y,i},this.setV=function(a){this.start=a.start,this.end=a.end,this.startControl=a.startControl,this.endControl=a.endControl,this.timeRatio=a.timeRatio,this.startTime=a.startTime,this.css=a.css,this.reverseCss=a.reverseCss},this.pointToPostion=function(a){var b=this.getPoint(a);return b.left=b.x+"px",b.top=b.y+"px",b},this.getTransform=function(a){this.reverse&&(a=1-a),a=a>1?1:a;var b={},c=(this.css.zoomRateX,this.css.zoomRateY,parseInt(this.css.rotate,10)),d=parseInt(this.reverseCss.rotate,10),e=(a-this.startTime)/this.timeRatio;return b.zoomX=this.reverseCss.zoomRateX+(this.css.zoomRateX-this.reverseCss.zoomRateX)*e,b.zoomY=this.reverseCss.zoomRateY+(this.css.zoomRateY-this.reverseCss.zoomRateY)*e,b.rotate=d+(c-d)*e,b}},a.fx.step.path=function(b){var c=b.end.pointToPostion(b.pos);b.elem.style.top=c.top,b.elem.style.left=c.left;var d=b.end.getTransform(b.pos);if(a(b.elem).css({transform:"translateZ(0) scale("+d.zoomX+","+d.zoomY+") rotate("+d.rotate+"deg)"}),a.isFunction(b.end.aniObject.running)&&b.end.aniObject.running(b.end.reverse?1-b.pos:b.pos),b.end.startNext===!0){var e,f=b.end.timeRatio*b.options.duration;e=b.end.reverse?b.end.reverseCss:b.end.css,a(b.elem).children().animate(e,{duration:f,queue:!1})}},a.fx.step.momentumScroll=function(b){var c=b.end.target,d=new a.path.bezier(b.end.target.options),e=b.end.startPos,f=b.end.pos,g=e+(f-e)*b.pos,h=d.pointToPostion(g),i=d.getTransform(g);c.$this.css({top:h.top,left:h.left,transform:"translateZ(0) scale("+i.zoomX+","+i.zoomY+") rotate("+i.rotate+"deg)"}),c.lastPosition=g},window.MultiBezier=b,b});