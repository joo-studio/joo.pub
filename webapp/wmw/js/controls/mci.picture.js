/**
* h5player v0.0.1 by yangyin 
* Copyright 2014 yangyin@mcitech.cn http://weibo.com/nodersolar
*/
!function(a){"function"==typeof define&&define.amd?define("mci.picture",["jquery","mci.support"],a):a(jQuery,Support)}(function(a,b){"use strict";function c(a,b){return d?a.changedTouches[0][b]:a[b]}var d=b.touch,e=b.touchStartEvent,f=b.touchMoveEvent,g=b.touchEndEvent,h=function(a){return this instanceof h?this.init(a):new h(a)};return h.prototype.init=function(b){var c=this;if(c.options=c.options||{description:"",url:"",eraseEffect:"",allowErase:!1,allowShare:!1,allowCollect:!1,finger:20},c.options=a.extend(c.options,b),c.dom=c.options.dom,c.canvasWrap=c.dom.find(">.mci-picture-canvas"),c.canvas=c.canvasWrap.find(">canvas")[0],!c.options.dom)throw"setting dom can't be null or undefine";c.scrolling=!1,"0"!=c.options.eraseEffect&&1==c.options.allowErase?c._drawImg():(c.dom.find(">.mci-picture-i").show(),c.dom.css({"pointer-events":"none"})),1==c.options.allowErase&&(c.dom[0].addEventListener(e,c,!1),c.dom[0].addEventListener(f,c,!1),c.dom[0].addEventListener(g,c,!1))},h.prototype._drawImg=function(){var b=this,c=b.canvas.getContext("2d"),d=b.dom.find(">.mci-picture-i >img");0==d.length&&(d=b.dom.find(">.mci-picture-i > .text-separated > .sperate-img >img")),a(d).each(function(){var b=a(this).parent(),d=parseInt(a(b).css("top"))||0,e=parseInt(a(b).css("left"))||0,f=new Image;f.src=a(this).attr("src"),f.onload=function(){c.drawImage(f,e,d)}}),b.readyEarse=!0},h.prototype.handleEvent=function(a){var b=this;switch(a.type){case"click":break;case e:b._touchStart(a);break;case f:b._touchMove(a);break;case g:b._touchEnd(a)}},h.prototype._touchStart=function(a){var b=this;b.scrolling||(a.preventDefault(),a.stopPropagation(),b.startPageX=c(a,"pageX"),b.startPageY=c(a,"pageY"),b.basePageX=b.startPageX,b.basePageY=b.startPageY,b.scrolling=!0,b.moveReady=!1)},h.prototype._touchMove=function(b){var d=this;if(d.scrolling){var e=d.canvas.getContext("2d"),f=a(d.canvas).offset(),g=c(b,"pageX")-f.left,h=c(b,"pageY")-f.top,i=d.options.finger||20,j=i/2;if(j>g||j>h)return!1;e.save(),e.arc(g,h,i,0,2*Math.PI,!1),e.clip(),e.clearRect(g-i-1,h-i-1,2*i+2,2*i+2),e.restore()}},h.prototype._touchEnd=function(){var a=this;a.scrolling=!1},window.Picture=h,h});