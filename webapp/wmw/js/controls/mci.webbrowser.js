/**
* h5player v0.0.1 by yangyin 
* Copyright 2014 yangyin@mcitech.cn http://weibo.com/nodersolar
*/
!function(a){"function"==typeof define&&define.amd?define("mci.webbrowser",["jquery","mci.support"],a):a(jQuery,Support)}(function(a,b){"use strict";function c(a,b){return d?a.changedTouches[0][b]:a[b]}var d=b.touch,e=b.touchStartEvent,f=b.touchMoveEvent,g=b.touchEndEvent,h=b.mouseOut,i="click",j=function(a){return this instanceof j?this.init(a):new j(a)};return j.prototype.init=function(b){var c=this;if(c.options=c.options||{url:"",autoScaleToFit:"",autoPlay:"",autoPlayDelay:"",coverRes:"",uiSupport:!1,bgTransparent:""},c.options=a.extend(c.options,b),!c.options.dom)throw"setting dom can't be null or undefine";if(c.dom=c.options.dom,c.iframeDom=c.dom.find(">iframe"),c.iframeConver=c.dom.find(">.mci-wb-state"),c.iframeDom.attr("allowtransparency","true"),!c.options.uiSupport){c.dom.find(">.mci-wb-bg").removeClass("none");var i=c.dom.find(">.mci-wb-bg")[0];c.iframeDom.on("load",function(){var a=c.iframeDom[0].contentWindow.document.body,b=a.scrollTop,j=a.scrollLeft;c.scrollHeight=a.scrollHeight,c.scrollWidth=a.scrollWidth,c.scrollDirection={x:!1,y:!1},c.currentPosition={x:j,y:b},c.currentPosition.y+c.options.height<c.scrollHeight&&(c.scrollDirection.y=!0),c.currentPosition.x+c.options.width<c.scrollWidth&&(c.scrollDirection.x=!0),(1==c.scrollDirection.x||1==c.scrollDirection.y)&&(i.addEventListener(e,c,!1),i.addEventListener(f,c,!1),i.addEventListener(g,c,!1),d||i.addEventListener(h,c,!1))})}},j.prototype.handleEvent=function(a){var b=this;switch(a.type){case i:b._click(a);break;case e:b._touchStart(a);break;case f:b._touchMove(a);break;case g:b._touchEnd(a);break;case h:b._touchOut(a)}},j.prototype._touchStart=function(a){var b=this;b.scrolling||(b.startPageX=c(a,"pageX"),b.startPageY=c(a,"pageY"),b.basePageX=b.startPageX,b.basePageY=b.startPageY,b.scrolling=!0,b.moveReady=!1)},j.prototype._touchMove=function(a){var b=this;if(b.scrolling){var d=c(a,"pageX"),e=c(a,"pageY"),f=0,g=0,h=0,i=0,j=0,k=0;if(b.moveReady)a.preventDefault(),a.stopPropagation(),f=d-b.basePageX,g=e-b.basePageY,j=b.currentPosition.x-f,k=b.currentPosition.y-g,b._setPosition({x:j,y:k});else{h=Math.abs(d-b.startPageX),i=Math.abs(e-b.startPageY);var l=!1,m=!1;h>5&&(l=!0),i>5&&(m=!0),h>=i?b.scrollDirection.x&&(b.moveReady=!0):b.scrollDirection.y&&(b.moveReady=!0)}b.basePageX=d,b.basePageY=e}},j.prototype._setPosition=function(a){var b=this;1==b.scrollDirection.x&&(b.currentPosition.x=a.x,a.x<=0&&(b.currentPosition.x=0),a.y+b.options.width>b.scrollWidth&&(b.currentPosition.x=b.scrollWidth-b.options.width)),1==b.scrollDirection.y&&(b.currentPosition.y=a.y,a.y<=0&&(b.currentPosition.y=0),a.y+b.options.height>b.scrollHeight&&(b.currentPosition.y=b.scrollHeight-b.options.height)),b.iframeDom[0].contentWindow.document.body.scrollLeft=b.currentPosition.x,b.iframeDom[0].contentWindow.document.body.scrollTop=b.currentPosition.y},j.prototype._touchEnd=function(){var a=this;a.scrolling=!1},j.prototype._touchOut=function(){var a=this;a.scrolling=!1},j.prototype._click=function(a){var b=this;0==b.options.autoPlay&&""!=b.options.coverRes&&(a.preventDefault(),a.stopPropagation(),b.iframeDom.attr("src",b.options.url).css({"z-index":"1"}),b.iframeConver.css({"z-index":"0"}),b.iframeConver[0].removeEventListener(i,b,!1))},j.prototype.start=function(){var a=this;a.options.autoPlay?(a.options.autoPlayDelay>0?setTimeout(function(){a.iframeDom.attr("src",a.options.url)},a.options.autoPlayDelay):a.iframeDom.attr("src",a.options.url),a.iframeConver.css({"z-index":"0"}),a.iframeDom.css({"z-index":"1"})):""!=a.options.coverRes&&a.options.uiSupport&&(a.iframeConver[0].addEventListener(i,a,!1),a.iframeConver.css({"z-index":"1"}),a.iframeDom.css({"z-index":"0"}))},window.WebBrowser=j,j});